define(["jquery","semantic","utils","gitee","axios"],(function(e,t,i,n,s){return{data:()=>({username:"",password:"",loginState:{}}),methods:{login(){return""===this.username.trim()||""===this.password.trim()?(i.message("请输入用户名密码！","warning"),!1):(s.post("https://gitee.com/oauth/token",{grant_type:"password",username:this.username,password:this.password,client_id:n.apiConfig.client_id,client_secret:n.apiConfig.client_secret,scope:"projects"}).then((e=>{localStorage.setItem(n.storageKey.lsLoginState,JSON.stringify(e)),n.initState().then((()=>{i.notify("登录成功","success"),this.$router.go(-1)})),this.username="",this.password=""})).catch((e=>{i.notify("登录失败","error")})),!1)},loginValid(){let e=localStorage.getItem(n.storageKey.lsLoginState);if(e){this.loginState=JSON.parse(e);let{created_at:t,expires_in:a,refresh_token:o}=this.loginState;Math.floor(Date.now()/1e3)-t>a&&s.post(`https://gitee.com/oauth/token?grant_type=refresh_token&refresh_token=${o}`).then((e=>{200===e.status&&(localStorage.setItem(n.storageKey.lsLoginState,JSON.stringify(e.data)),n.initState().then((()=>{i.notify("Token刷新成功","success"),this.$router.go(-1)})))}))}}},mounted(){this.loginValid()},template:'\n            <div class="ui inverted segment middle aligned center aligned grid flex-grow-1 rounded-0 p-2 m-0 wyd-home">\n              <div class="column border border-secondary rounded" style="max-width: 450px">\n                <h1 class="ui teal image header">\n                  <div class="content">\n                     请登录 <i class="sign in alternate icon"></i>\n                  </div>\n                </h1>\n                <div class="ui large form">\n                  <div class="ui stacked">\n                    <div class="field">\n                      <div class="ui left icon input">\n                        <i class="user icon"></i>\n                        <input @keyup.enter="login" type="text" name="username" placeholder="用户名" v-model="username">\n                      </div>\n                    </div>\n                    <div class="field">\n                      <div class="ui left icon input">\n                        <i class="lock icon"></i>\n                        <input @keyup.enter="login" type="password" name="password" placeholder="密码" v-model="password">\n                      </div>\n                    </div>\n                    <div class="ui fluid large teal submit button" @click="login">登录</div>\n                    <div class="mt-3" v-if="loginState.access_token">\n                        <div class="text-success my-3">已有登录状态</div>\n                        <div class="text-left mb-2">登录时间 => {{new Date(loginState.created_at*1000).toLocaleString()}}</div>\n                        <div class="text-left mb-2">过期时间 => {{new Date((loginState.created_at+loginState.expires_in)*1000).toLocaleString()}}</div>\n                        <div class="text-left mb-2 text-truncate">AccessToken => {{loginState.access_token}}</div>\n                        <div class="text-left mb-2 text-truncate">RefreshToken => {{loginState.refresh_token}}</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n        '}}));