define(["jquery","semantic","utils","gitee","axios"],(function(e,t,i,s,n){return{data:()=>({username:"",password:""}),methods:{login(){return""===this.username.trim()||""===this.password.trim()?(i.message("请输入用户名密码！","warning"),!1):(n.post("https://gitee.com/oauth/token",{grant_type:"password",username:this.username,password:this.password,client_id:s.apiConfig.client_id,client_secret:s.apiConfig.client_secret,scope:"projects"}).then((e=>{localStorage.setItem(s.storageKey.lsLoginState,JSON.stringify(e)),s.initState().then((()=>{i.notify("登录成功","success"),this.$router.go(-1)})),this.username="",this.password=""})).catch((e=>{i.notify("登录失败","error")})),!1)},loginValid(){let e=localStorage.getItem(s.storageKey.lsLoginState);if(e){let{created_at:t,expires_in:a,refresh_token:o}=JSON.parse(e);Math.floor(Date.now()/1e3)-t>a&&n.post(`https://gitee.com/oauth/token?grant_type=refresh_token&refresh_token=${o}`).then((e=>{200===e.status&&(localStorage.setItem(s.storageKey.lsLoginState,JSON.stringify(e.data)),s.initState().then((()=>{i.notify("Token刷新成功","success"),this.$router.go(-1)})))}))}}},mounted(){this.loginValid()},template:'\n            <div class="ui inverted segment middle aligned center aligned grid h-100 p-2 m-0">\n              <div class="column" style="max-width: 450px">\n                <h1 class="ui teal image header">\n                  <div class="content">\n                     请登录 <i class="sign in alternate icon"></i>\n                  </div>\n                </h1>\n                <div class="ui large form">\n                  <div class="ui stacked">\n                    <div class="field">\n                      <div class="ui left icon input">\n                        <i class="user icon"></i>\n                        <input @keyup.enter="login" type="text" name="username" placeholder="用户名" v-model="username">\n                      </div>\n                    </div>\n                    <div class="field">\n                      <div class="ui left icon input">\n                        <i class="lock icon"></i>\n                        <input @keyup.enter="login" type="password" name="password" placeholder="密码" v-model="password">\n                      </div>\n                    </div>\n                    <div class="ui fluid large teal submit button" @click="login">登录</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n        '}}));