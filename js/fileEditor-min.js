initApp().then((()=>{let e;require.config({paths:{vs:"../cdn/monaco-editor/min/vs"}});let t=!1,i=common.tip,l=new Vue({el:"#root",data:()=>({selectedFile:"",fileList:[],inputTxt:"",editor:null,showIframe:!1,renderFileContent:"<h2>Hello</h2>",actions:[]}),methods:{initActions(){this.actions.push({title:"Actions",children:[{title:"在iframe中预览",call:()=>{let t=e.getValue();l.renderFileContent=t,l.showIframe=!0}},{title:"js eval",call:()=>{let t=e.getModel().getValueInRange(e.getSelection());window.eval(t)}},{title:"切换主题",call:()=>{e.updateOptions({theme:t?"vs":"vs-dark"}),t=!t}},{title:"保存文件",call:()=>{l.update()}},{title:"同步文件",call:()=>{l.loadFile(!0)}},{title:"同步文件树",call:()=>{confirm("确认清空文件树缓存？")&&common.initFileTree().then((e=>{l.initFileList(e),l.loadFile()}))}}]})},initFileList(e){this.fileList=[];let t=[];for(let i in e)this.fileList.push(i),t.push({title:i,call:this.fileClickCall.bind(this,i)});this.actions=[],this.initActions(),this.actions.push({title:"Files",children:t})},fileClickCall(e){this.selectedFile=e,this.$nextTick((()=>{this.loadFile()}))},loadFile(t=!1){common.getContent(this.selectedFile,t).then((l=>{let n=this.selectedFile.substr(this.selectedFile.lastIndexOf(".")+1);switch(n){case"md":n="markdown";break;default:break}monaco.editor.setModelLanguage(e.getModel(),n),e.setValue(l),t&&i("文件加载完成!",`已重新加载文件 => ${this.selectedFile}`)}))},update(){if(""===this.selectedFile)return void i("请选择编辑文件");let t=e.getValue();common.updateFile(this.selectedFile,t)},closeIframe(){this.showIframe=!1},listenEvent(){$(window).keydown((function(e){83===e.keyCode&&e.ctrlKey&&(l.update(),e.preventDefault())}))}},mounted(){this.initActions(),this.initFileList(common.fileTree),require(["vs/editor/editor.main"],(function(){e=monaco.editor.create(document.getElementById("container"),{value:"",language:"markdown",theme:"vs",automaticLayout:!0})})),this.listenEvent()}})}));