const vappComponents=function(){const t={template:$("#page-about").html()},e={template:$("#page-header").html(),data:()=>({title:"Yanhui",menus:[{title:"Home",url:"#/home"},{title:"About",url:"#/about"},{title:"Links",children:[{title:"semantic-ui",url:"https://zijieke.com/semantic-ui/"}]}]}),methods:{}};return{Home:function(){let t=[],e=[],o=[];function a(t,n,i){if(t.a)for(let o of t.a)o.a?(e.push({name:o.b,type:n}),a(o,n,o.b)):a(o,n,i);else t.c&&(n&&(t.type=n),i&&(t.tag=i),o.push(t))}return{template:$("#page-home").html(),data:()=>({bmTypeList:[],bmTagList:[],bmList:[],checkedType:"",checkedTag:"",searchTxt:"",loading:!1}),watch:{checkedType(t){this.checkedTag="",this.bmTagList=e.filter((e=>e.type===t)),this.bmList=o.filter((e=>e.type===t))}},methods:{initSearch(){$(".ui.search").search({source:[{title:"test",actionUrl:"https://zijieke.com/semantic-ui/modules/search.php#/settings"}],minCharacters:0,selectFirstResult:!0,onSelect(t,e){}})},logout(){confirm("确认登出？")&&(localStorage.clear(),window.location.href="/login.html")},search(){this.bmList=o.filter((t=>-1!==t.b.toUpperCase().indexOf(this.searchTxt.toUpperCase())||-1!==t.c.toUpperCase().indexOf(this.searchTxt.toUpperCase()))),this.checkedTag="",this.searchTxt=""},typeClick(t){this.bmList=o.filter((e=>e.type===t))},tagClick(t){let e=t.name;t.name===this.checkedTag&&(this.checkedTag="",e=""),this.checkedTag=e,this.bmList=""!==e?o.filter((t=>!!t.tag&&t.tag===e)):o.filter((t=>t.type===this.checkedType))},refreshData(){return confirm("确认重新下载书签数据？")&&(this.loading=!0,this.checkedType="",this.checkedTag="",o=[],t=[],e=[],this.bmTypeList=[],this.bmTagList=[],this.bmList=[],this.loadData(!0),setTimeout((()=>{this.loading=!1}),3e3)),!1},loadData(t){common.getContent("json/chrome.bookmark.json",t).then((t=>{this.bmDataHandle(t)}))},bmDataHandle(n){let i=JSON.parse(n).a;for(let e of i)e.a?(a(e,e.b,null),t.push(e.b)):a(e,null,null);this.checkedType=t[0],this.bmTypeList=t,this.bmTagList=e,this.bmList=o,this.loading=!1}},mounted(){t=[],e=[],o=[],this.loadData()}}}(),Header:e,About:t}}(),vappStart=function(){const t=[{path:"/",redirect:"/home"},{path:"/home",component:vappComponents.Home},{path:"/about",component:vappComponents.About}],e=new VueRouter({routes:t});return()=>{new Vue({el:"#root",components:{"app-header":vappComponents.Header},router:e,data:()=>({title:"Hello Vue..."}),mounted(){}})}}(),common=function(){let t={};const e="login-state",o="fileList",a="json/config.json",n={client_id:"f5250ed1c6f0a51423ca06aa4faf5c10d64ce8b411c425256d22fec16a531665",client_secret:"00a0f31357ce04fe3619eab7149d7c1b4daade23677a898b8f14bb647bc25fb3",username:"yanhui1993",project:"webdata"};if("/login.html"===window.location.pathname)return{config:n};let i=localStorage.getItem(e);if("/login.html"!==window.location.pathname&&!i)return void(window.location.href=`/login.html?page=${window.location.pathname}`);let{access_token:r,created_at:c,expires_in:s,refresh_token:h}=JSON.parse(i),l={};function m(t,e=""){window.Notification?Notification.requestPermission((function(o){let a=new Notification(t,{body:e,dir:"rtl",icon:"https://yanhui1993.gitee.io/imgs/logo.jpg"});a.onshow=function(){setTimeout(a.close.bind(a),3e3)}})):alert(t)}async function p(t,e=!1){let o=localStorage.getItem(t);if(!e&&o)return u.decode(o);let a=await axios.get(`https://gitee.com/api/v5/repos/${n.username}/${n.project}/contents/${t}?access_token=${r}`);return a.content?(localStorage.setItem(t,a.content),u.decode(a.content)):null}async function d(){let t=(await axios.get(`https://gitee.com/api/v5/repos/${n.username}/${n.project}/git/trees/master?access_token=${r}&recursive=1`)).tree,e={};for(let o of t)"blob"===o.type&&(e[o.path]=o.sha);return l=e,localStorage.setItem(o,JSON.stringify(e)),l}const u={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,o,a,n,i,r,c,s="",h=0;for(t=u._utf8_encode(t);h<t.length;)n=(e=t.charCodeAt(h++))>>2,i=(3&e)<<4|(o=t.charCodeAt(h++))>>4,r=(15&o)<<2|(a=t.charCodeAt(h++))>>6,c=63&a,isNaN(o)?r=c=64:isNaN(a)&&(c=64),s=s+this._keyStr.charAt(n)+this._keyStr.charAt(i)+this._keyStr.charAt(r)+this._keyStr.charAt(c);return s},decode:function(t){var e,o,a,n,i,r,c="",s=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<t.length;)e=this._keyStr.indexOf(t.charAt(s++))<<2|(n=this._keyStr.indexOf(t.charAt(s++)))>>4,o=(15&n)<<4|(i=this._keyStr.indexOf(t.charAt(s++)))>>2,a=(3&i)<<6|(r=this._keyStr.indexOf(t.charAt(s++))),c+=String.fromCharCode(e),64!=i&&(c+=String.fromCharCode(o)),64!=r&&(c+=String.fromCharCode(a));return c=u._utf8_decode(c)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",o=0;o<t.length;o++){var a=t.charCodeAt(o);a<128?e+=String.fromCharCode(a):a>127&&a<2048?(e+=String.fromCharCode(a>>6|192),e+=String.fromCharCode(63&a|128)):(e+=String.fromCharCode(a>>12|224),e+=String.fromCharCode(a>>6&63|128),e+=String.fromCharCode(63&a|128))}return e},_utf8_decode:function(t){for(var e="",o=0,a=c1=c2=0;o<t.length;)(a=t.charCodeAt(o))<128?(e+=String.fromCharCode(a),o++):a>191&&a<224?(c2=t.charCodeAt(o+1),e+=String.fromCharCode((31&a)<<6|63&c2),o+=2):(c2=t.charCodeAt(o+1),c3=t.charCodeAt(o+2),e+=String.fromCharCode((15&a)<<12|(63&c2)<<6|63&c3),o+=3);return e}};return async function(){return new Promise((async n=>{window.axios&&(axios.interceptors.request.use((function(t){return t}),(function(t){return Promise.reject(t)})),axios.interceptors.response.use((function(t){return 200===t.status?t.data:t}),(function(t){if(401!==t.response.status||"/login.html"===window.location.pathname)return Promise.reject(t);window.location.href="/login.html"}))),await async function(){if(Math.floor(Date.now()/1e3)-c>s){let t=await axios.post(`https://gitee.com/oauth/token?grant_type=refresh_token&refresh_token=${h}`);if(200!==t.status)return void(window.location.href="/login.html");{let o=JSON.stringify(t.data);r=t.data.access_token,localStorage.setItem(e,o)}}let n=localStorage.getItem(o);n?l=JSON.parse(n):await d();let i=await p(a);t=JSON.parse(i)}(),n()}))}().then(vappStart),{config:n,fileTree:l,getContent:p,updateFile:async function(t,e){let o=l[t];if(!o)return void m(`未匹配匹配文件 ${t}`);let a=u.encode(e);axios.put(`https://gitee.com/api/v5/repos/${n.username}/${n.project}/contents/${t}`,{access_token:r,content:a,sha:o,message:`open api update ${window.location.pathname}`}).then((()=>{m(`更新[${t}]成功！`),localStorage.setItem(t,a),d()})).catch((t=>{m("更新异常！")}))},newFile:async function(t,e){if(!t||!e)return;let o=u.encode(e);axios.post(`https://gitee.com/api/v5/repos/${n.username}/${n.project}/contents/${t}`,{access_token:r,content:o,message:`open api new ${window.location.pathname}`}).then((t=>{m("新增成功！"),d()})).catch((t=>{m("新增异常！")}))},base64:u,tip:m,initFileTree:d}}();