initApp().then((()=>{let t=common.tip,e=new Vue({el:"#root",data:()=>({selectedFile:"",fileList:[],editor:null,actions:[]}),methods:{initActions(){this.actions.push({title:"Actions",children:[{title:"更新文件",call:()=>{this.update()}},{title:"同步文件",call:()=>{this.syncFile()}},{title:"同步文件树",call:()=>{this.syncFileTree()}}]})},initFileList(t){let e=[];for(let i in t)i&&i.endsWith(".md")&&(this.fileList.push(i),e.push({title:i,call:this.fileClickCall.bind(this,i)}));this.actions.push({title:"Files",children:e})},fileClickCall(t){this.selectedFile=t,this.$nextTick((()=>{this.loadFile()}))},loadFile(e=!1){common.getContent(this.selectedFile,e).then((i=>{this.editor.setValue(i),e&&t("文件加载完成!",`已重新加载文件 => ${this.selectedFile}`)}))},update(){if(""===this.selectedFile)return void t("请选选择文件！");let e=this.editor.getValue();common.updateFile(this.selectedFile,e)},syncFile(){""!==this.selectedFile?this.loadFile(!0):t("请选选择文件！")},syncFileTree(){confirm("确认同步文件树？")&&common.initFileTree().then((e=>{t("同步文件树完成！"),this.actions=[],this.initActions(),this.fileList=[],this.initFileList(e)}))},listenEvent(){$(window).keydown((function(t){83===t.keyCode&&t.ctrlKey&&(e.update(),t.preventDefault())}))}},mounted(){this.initActions(),this.initFileList(common.fileTree),this.editor=editormd("test-editor",{mode:"gfm",width:"98%",autoHeight:!0,path:"../cdn/editormd/lib/",watch:!1,tocm:!0,taskList:!0,emoji:!0,tex:!0,flowChart:!0,sequenceDiagram:!0,toolbarIcons:["undo","redo","|","bold","del","italic","quote","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","watch","fullscreen"],onload:()=>{this.loadFile()}}),this.listenEvent()}})}));