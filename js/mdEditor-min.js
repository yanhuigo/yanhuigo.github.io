initApp().then((()=>{let e=common.tip,t=new Vue({el:"#root",data(){return{selectedFile:"test/test.md",fileList:[],editor:null,actions:{title:"Actions",children:[{title:"更新文件",call:()=>{this.update()}},{title:"同步文件",call:()=>{this.syncFile()}},{title:"同步文件树",call:()=>{this.syncFileTree()}}]}}},methods:{initFileList(){for(let e in common.fileTree)e&&e.endsWith(".md")&&this.fileList.push(e)},loadFile(t=!1){common.getContent(this.selectedFile,t).then((i=>{this.editor.setValue(i),t&&e("文件加载完成!",`已重新加载文件 => ${this.selectedFile}`)}))},update(){if(""===this.selectedFile)return void e("请选选择文件！");let t=this.editor.getValue();common.updateFile(this.selectedFile,t)},syncFile(){""!==this.selectedFile?this.loadFile(!0):e("请选选择文件！")},syncFileTree(){confirm("确认同步文件树？")&&common.initFileTree().then((()=>{e("同步文件树完成！"),this.fileList=[],this.initFileList()}))},listenEvent(){$(window).keydown((function(e){83===e.keyCode&&e.ctrlKey&&(t.update(),e.preventDefault())}))}},mounted(){this.initFileList(),this.editor=editormd("test-editor",{mode:"gfm",width:"98%",autoHeight:!0,path:"../cdn/editormd/lib/",watch:!0,tocm:!0,taskList:!0,emoji:!0,tex:!0,flowChart:!0,sequenceDiagram:!0,onload:()=>{this.loadFile()}}),this.listenEvent()}})}));