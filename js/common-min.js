let initAsyncFunc=async function(e){let t={};const n="login-state",a="fileList",o="json/config.json",i={client_id:"f5250ed1c6f0a51423ca06aa4faf5c10d64ce8b411c425256d22fec16a531665",client_secret:"00a0f31357ce04fe3619eab7149d7c1b4daade23677a898b8f14bb647bc25fb3",username:"yanhui1993",project:"webdata"};if("/login.html"===window.location.pathname)return{config:i};let r=localStorage.getItem(n);if("/login.html"!==window.location.pathname&&!r)return void(window.location.href=`/login.html?page=${window.location.pathname}`);let{access_token:l,created_at:c,expires_in:s,refresh_token:d}=JSON.parse(r),u={};async function f(e){return new Promise((t=>{w(e,(()=>{t()}))}))}function m(e,t=""){window.Notification?Notification.requestPermission((function(n){let a=new Notification(e,{body:t,dir:"rtl",icon:"https://yanhui1993.gitee.io/imgs/logo.jpg"});a.onshow=function(){setTimeout(a.close.bind(a),3e3)}})):alert(e)}async function p(e,t=!1){let n=localStorage.getItem(e);if(!t&&n)return b.decode(n);let a=await axios.get(`https://gitee.com/api/v5/repos/${i.username}/${i.project}/contents/${e}?access_token=${l}`);return a.content?(localStorage.setItem(e,a.content),b.decode(a.content)):null}async function h(){let e=(await axios.get(`https://gitee.com/api/v5/repos/${i.username}/${i.project}/git/trees/master?access_token=${l}&recursive=1`)).tree,t={};for(let n of e)"blob"===n.type&&(t[n.path]=n.sha);return u=t,localStorage.setItem(a,JSON.stringify(t)),u}function g(){axios.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),axios.interceptors.response.use((function(e){return 200===e.status?e.data:e}),(function(e){if(401!==e.response.status||"/login.html"===window.location.pathname)return Promise.reject(e);window.location.href="/login.html"}))}const b={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,a,o,i,r,l,c="",s=0;for(e=b._utf8_encode(e);s<e.length;)o=(t=e.charCodeAt(s++))>>2,i=(3&t)<<4|(n=e.charCodeAt(s++))>>4,r=(15&n)<<2|(a=e.charCodeAt(s++))>>6,l=63&a,isNaN(n)?r=l=64:isNaN(a)&&(l=64),c=c+this._keyStr.charAt(o)+this._keyStr.charAt(i)+this._keyStr.charAt(r)+this._keyStr.charAt(l);return c},decode:function(e){var t,n,a,o,i,r,l="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)t=this._keyStr.indexOf(e.charAt(c++))<<2|(o=this._keyStr.indexOf(e.charAt(c++)))>>4,n=(15&o)<<4|(i=this._keyStr.indexOf(e.charAt(c++)))>>2,a=(3&i)<<6|(r=this._keyStr.indexOf(e.charAt(c++))),l+=String.fromCharCode(t),64!=i&&(l+=String.fromCharCode(n)),64!=r&&(l+=String.fromCharCode(a));return l=b._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var a=e.charCodeAt(n);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},_utf8_decode:function(e){for(var t="",n=0,a=c1=c2=0;n<e.length;)(a=e.charCodeAt(n))<128?(t+=String.fromCharCode(a),n++):a>191&&a<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&a)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&a)<<12|(63&c2)<<6|63&c3),n+=3);return t}};function w(e,t){let n=document.createElement("script"),a=t||function(){};n.type="text/javascript",n.readyState?n.onreadystatechange=function(){"loaded"!==n.readyState&&"complete"!==n.readyState||(n.onreadystatechange=null,a())}:n.onload=function(){a()},n.src=e,document.getElementsByTagName("head")[0].appendChild(n)}function k(e,t){let n=document.createElement("link"),a=t||function(){};n.rel="stylesheet",n.readyState?n.onreadystatechange=function(){"loaded"!==n.readyState&&"complete"!==n.readyState||(n.onreadystatechange=null,a())}:n.onload=function(){a()},n.href=e,document.getElementsByTagName("head")[0].appendChild(n)}return await async function(){if(e.loadDefault){let t=["/cdn/vue/vue.min.js","/cdn/axios.min.js","/cdn/bootstrap/jquery.slim.min.js"],n=["/cdn/bootstrap/bootstrap.min.js","/cdn/bootstrap/bootstrap.min.css","/cdn/font-awesome-4.7.0/css/font-awesome.min.css"];e.baseLibs&&(t=t.concat(e.baseLibs)),e.asyncLibs&&(n=n.concat(e.asyncLibs)),await async function(e=[]){for(let t of e)await f(t)}(t),g();for(let e of n)-1!==e.indexOf(".css")?k(e):w(e)}else window.axios&&g();return new Promise((async e=>{window.Vue&&function(){let e=[{title:"OpenApi",children:[{title:"更新应用配置",call:()=>{confirm("确认清空应用配置并刷新页面？")&&(localStorage.removeItem(o),window.location.reload())}},{title:"清空所有缓存",call:()=>{if(confirm("确认清空所有缓存并刷新页面？")){for(let e in localStorage)localStorage.hasOwnProperty(e)&&e!==n&&localStorage.removeItem(e);window.location.reload()}}},{title:"同步文件树",call:()=>{confirm("确认同步文件树？")&&h().then((()=>{m("同步文件树完成！")}))}}]}];Vue.component("yanhui-header-element",{data:()=>({links:[]}),mounted(){this.links=t.navLinks.concat([]),this.operations&&this.links.push({title:"Action",children:this.operations?this.operations:[]})},methods:{handleSelect(e,t){let n=this[`menuCall${String(e).replace("-","_")}`];n&&n()},menuCall0(){alert(1)},menuCall1_0(){alert(2)}},template:'\n                <el-menu :default-active="0" class="el-menu-demo" mode="horizontal" @select="handleSelect">\n                    <template v-for="(link,index) in links">\n                        <el-menu-item v-if="!link.children" :index="index">{{link.title}}</el-menu-item>\n                        <el-submenu v-else :index="index">\n                            <template slot="title">{{link.title}}</template>\n                            <el-menu-item v-for="(subLink,subIndex) in link.children" :index="index+\'-\'+subIndex">{{subLink.title}}</el-menu-item>\n                        </el-submenu>\n                    </template>\n                </el-menu>\n            '}),Vue.component("yanhui-header",{data:()=>({}),methods:{},mounted(){},props:["title","icon","actions"],computed:{links:function(){return t.navLinks.concat(e).concat(this.actions)}},template:'\n                <nav class="navbar navbar-expand-lg navbar-dark bg-dark">\n                    <i class="fa fa-2x text-light link mr-2 title-align-sub" :class="icon?\'fa-\'+icon:\'fa-paper-plane-o\'"></i>\n                    <a class="navbar-brand" href="#">{{title}}</a>\n                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">\n                        <span class="navbar-toggler-icon"></span>\n                    </button>\n                  <div class="collapse navbar-collapse" id="navbarSupportedContent">\n                    <ul class="navbar-nav mr-auto">\n                      \n                      <li class="nav-item" :class="link.children ? \'dropdown\' : \'\'" v-for="(link,index) in links">\n                        \n                        <template v-if="!link.children">\n                            <a v-if="link.call" class="nav-link" target="_blank" href="###" @click.prevent="link.call">{{link.title}} <span class="sr-only">(current)</span></a>\n                            <a v-else target="_blank" :href="link.url">{{link.title}} <span class="sr-only">(current)</span></a>\n                        </template>\n\n                        <template v-else>\n                            <a class="nav-link dropdown-toggle" href="#" :id="\'navbarDropdown\'+index" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                              {{link.title}}\n                            </a>\n                            <div v-if="link.children" class="dropdown-menu" :aria-labelledby="\'navbarDropdown\'+index">\n                                <template v-for="subLink in link.children">\n                                    <a v-if="subLink.call" class="dropdown-item" href="###" @click.prevent="subLink.call">{{subLink.title}}</a>\n                                    <a v-else class="dropdown-item" :href="subLink.url" target="_blank">{{subLink.title}}</a>\n                                </template>\n                            </div>\n                        </template>\n                      </li>\n                    </ul>\n                    <form class="form-inline my-2 my-lg-0 text-light">\n                        <slot name="headerRight"></slot>\n                    </form>\n                  </div>\n                </nav>\n            '})}(),await async function(){if(Math.floor(Date.now()/1e3)-c>s){let e=await axios.post(`https://gitee.com/oauth/token?grant_type=refresh_token&refresh_token=${d}`);if(200!==e.status)return void(window.location.href="/login.html");{let t=JSON.stringify(e.data);l=e.data.access_token,localStorage.setItem(n,t)}}let e=localStorage.getItem(a);e?u=JSON.parse(e):await h();let i=await p(o);t=JSON.parse(i)}(),e()}))}(),{config:i,fileTree:u,getContent:p,updateFile:async function(e,t){let n=u[e];if(!n)return void m(`未匹配匹配文件 ${e}`);let a=b.encode(t);axios.put(`https://gitee.com/api/v5/repos/${i.username}/${i.project}/contents/${e}`,{access_token:l,content:a,sha:n,message:`open api update ${window.location.pathname}`}).then((()=>{m(`更新[${e}]成功！`),localStorage.setItem(e,a),h()})).catch((e=>{m("更新异常！")}))},newFile:async function(e,t){if(!e||!t)return;let n=b.encode(t);axios.post(`https://gitee.com/api/v5/repos/${i.username}/${i.project}/contents/${e}`,{access_token:l,content:n,message:`open api new ${window.location.pathname}`}).then((e=>{m("新增成功！"),h()})).catch((e=>{m("新增异常！")}))},base64:b,tip:m,initFileTree:h,loadLibs:w}};window.initApp=async(e={})=>{window.common=await initAsyncFunc(e)},$((()=>{$(".dropdown-toggle").dropdown()}));